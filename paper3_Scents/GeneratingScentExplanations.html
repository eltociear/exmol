

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Code to Generate Explanations for Different Scents &mdash; exmol  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../toc.html" class="icon icon-home"> exmol
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper2_LIME/Tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper1_CFs/Schematic.html">MMACE Paper: Counterfactual Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper1_CFs/RF.html">MMACE Paper: Random Forest for Blood-Brain Barrier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper1_CFs/GNN.html">MMACE Paper: Graph Neural Network for HIV Inhibition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper1_CFs/Solubility-RNN.html">MMACE Paper: Recurrent Neural Network for Predicting Solubility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper2_LIME/Solubility-RNN.html">LIME paper: Recurrent Neural Network for Solubility Prediciton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../paper2_LIME/RF-lime.html">LIME paper: Random Forest for Solubility Prediciton</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../toc.html">exmol</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../toc.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Code to Generate Explanations for Different Scents</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/ur-whitelab/exmol/blob/main/docs/source/paper3_Scents/GeneratingScentExplanations.ipynb" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="code-to-generate-explanations-for-different-scents">
<h1>Code to Generate Explanations for Different Scents<a class="headerlink" href="#code-to-generate-explanations-for-different-scents" title="Permalink to this heading">¶</a></h1>
<p>Using exmol package: https://github.com/ur-whitelab/exmol</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Imports
from typing import *
import exmol

import seaborn as sns
import pandas as pd
import numpy as np
import rdkit, rdkit.Chem, rdkit.Chem.rdDepictor, rdkit.Chem.Draw
from IPython.display import display, SVG
from rdkit.Chem.Draw import MolToImage as mol2img, DrawMorganBit  # type: ignore
from rdkit.Chem import rdchem, MACCSkeys, AllChem  # type: ignore
import skunk
import cairosvg
import matplotlib
import warnings

warnings.filterwarnings(&quot;ignore&quot;)

import pyrfume  # for loading dataset

# Packages needed for GNN model (model used when creating spaces)
##not needed if generating descriptor explanations or NLEs using a previously created sample space
import haiku as hk
import jax
import jax.numpy as jnp
import tensorflow as tf

# Plotting style
import matplotlib.pyplot as plt
import matplotlib.font_manager as font_manager
import urllib.request

urllib.request.urlretrieve(
    &quot;https://github.com/google/fonts/raw/main/ofl/ibmplexmono/IBMPlexMono-Regular.ttf&quot;,
    &quot;IBMPlexMono-Regular.ttf&quot;,
)
fe = font_manager.FontEntry(fname=&quot;IBMPlexMono-Regular.ttf&quot;, name=&quot;plexmono&quot;)
font_manager.fontManager.ttflist.append(fe)
plt.rcParams.update(
    {
        &quot;axes.facecolor&quot;: &quot;#f5f4e9&quot;,
        &quot;grid.color&quot;: &quot;#AAAAAA&quot;,
        &quot;axes.edgecolor&quot;: &quot;#333333&quot;,
        &quot;figure.facecolor&quot;: &quot;#FFFFFF&quot;,
        &quot;axes.grid&quot;: False,
        &quot;axes.prop_cycle&quot;: plt.cycler(&quot;color&quot;, plt.cm.Dark2.colors),
        &quot;font.family&quot;: fe.name,
        &quot;figure.figsize&quot;: (3.5, 3.5 / 1.2),
        &quot;ytick.left&quot;: True,
        &quot;xtick.bottom&quot;: True,
    }
)


np.random.seed(0)
tf.random.set_seed(0)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">rdchem</span><span class="p">,</span> <span class="n">MACCSkeys</span><span class="p">,</span> <span class="n">AllChem</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">import</span> <span class="nn">skunk</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="kn">import</span> <span class="nn">cairosvg</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">import</span> <span class="nn">warnings</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;cairosvg&#39;
</pre></div>
</div>
</div>
</div>
<section id="gnn-model-related-code">
<h2>GNN model related code<a class="headerlink" href="#gnn-model-related-code" title="Permalink to this heading">¶</a></h2>
<p>Code below modified from example code given in the “Predicting DFT Energies with GNNs”, “Interpretability and Deep Learning” sections of “Deep Learning for Molecules and Materials” textbook (https://dmol.pub/applied/QM9.html)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Parameters for GNN model (parameters being read in)
node_feat_length = 256
message_feat_length = 256
graph_feat_length = 512
weights_stddevGNN = 0.01

# Load data from pyrfume
scentdata = scentdata = pyrfume.load_data(
    &quot;leffingwell/leffingwell_data.csv&quot;, remote=True
)


# Code to generate list of all scent labels (scentClasses)
numMolecules = len(scentdata.odor_labels_filtered)
numClasses = 112  # No odorless class
scentClasses = pd.read_csv(&quot;scentClasses.csv&quot;)
scentClasses = scentClasses[&quot;Scent&quot;].tolist()
moleculeScentList = []
for i in range(numMolecules):
    scentString = scentdata.odor_labels_filtered[i]
    temp = scentString.replace(&quot;[&quot;, &quot;&quot;)
    temp = temp.replace(&quot;]&quot;, &quot;&quot;)
    temp = temp.replace(&quot;&#39;&quot;, &quot;&quot;)
    temp = temp.replace(&quot; &quot;, &quot;&quot;)
    scentList = temp.split(&quot;,&quot;)
    if &quot;odorless&quot; in scentList:
        scentList.remove(&quot;odorless&quot;)
    moleculeScentList.append(scentList)


def gen_smiles2graph(sml):
    &quot;&quot;&quot;Argument for the RD2NX function should be a valid SMILES sequence
    returns: the graph
    &quot;&quot;&quot;
    m = rdkit.Chem.MolFromSmiles(sml)
    m = rdkit.Chem.AddHs(m)
    order_string = {
        rdkit.Chem.rdchem.BondType.SINGLE: 1,
        rdkit.Chem.rdchem.BondType.DOUBLE: 2,
        rdkit.Chem.rdchem.BondType.TRIPLE: 3,
        rdkit.Chem.rdchem.BondType.AROMATIC: 4,
    }
    N = len(list(m.GetAtoms()))
    nodes = np.zeros((N, node_feat_length))
    for i in m.GetAtoms():
        nodes[i.GetIdx(), i.GetAtomicNum()] = 1
        # Add in whether atom is in a ring or not for one-hot encoding
        if i.IsInRing():
            nodes[i.GetIdx(), -1] = 1

    adj = np.zeros((N, N))
    for j in m.GetBonds():
        u = min(j.GetBeginAtomIdx(), j.GetEndAtomIdx())
        v = max(j.GetBeginAtomIdx(), j.GetEndAtomIdx())
        order = j.GetBondType()
        if order in order_string:
            order = order_string[order]
        else:
            raise Warning(&quot;Ignoring bond order&quot; + order)
        adj[u, v] = 1
        adj[v, u] = 1
    adj += np.eye(N)
    return nodes, adj


# Function that creates label vector given list of strings describing scent of molecule as input
# Each index in label vector corresponds to specific scent -&gt; if output has a 0 at index i, then molecule does not have scent i
# If label vector has 1 at index i, then molecule does have scent i


def createLabelVector(scentsList):
    # Find class index in label vector that each scent corresponds to &amp; update label for that molecule to 1
    labelVector = np.zeros(numClasses)
    for j in range(len(scentsList)):
        # Find class index
        classIndex = scentClasses.index(scentsList[j])
        # print(classIndex)
        # print(scentsList[j])
        # print(scentClasses[classIndex])
        # Update label vector
        labelVector[classIndex] = 1
    return labelVector


def generateGraphs():
    for i in range(numMolecules):
        graph = gen_smiles2graph(scentdata.smiles[i])
        labels = createLabelVector(moleculeScentList[i])
        yield graph, labels


# Get graph data for training, testing &amp; validation sets
data = tf.data.Dataset.from_generator(
    generateGraphs,
    output_types=((tf.float32, tf.float32), tf.float32),
    output_shapes=(
        (tf.TensorShape([None, node_feat_length]), tf.TensorShape([None, None])),
        tf.TensorShape([None]),
    ),
)


class GNNLayer(hk.Module):
    def __init__(self, output_size, name=None):
        super().__init__(name=name)
        self.output_size = output_size

    def __call__(self, inputs):
        # split input into nodes, edges &amp; features
        nodes, edges, features = inputs
        # Nodes is of shape (N, Nf) --&gt; N = # atoms, Nf = node_feature_length
        # Edges is of shape (N,N) (adjacency matrix)
        # Features is of shape (Gf) --&gt; Gf = graph_feature_length

        graph_feature_len = features.shape[-1]  # graph_feature_len (Gf)
        node_feature_len = nodes.shape[-1]  # node_feature_len (Nf)
        message_feature_len = message_feat_length  # message_feature_length (Mf)

        # Initialize weights
        w_init = hk.initializers.RandomNormal(stddev=weights_stddevGNN)

        # we is of shape (Nf,Mf)
        we = hk.get_parameter(
            &quot;we&quot;, shape=[node_feature_len, message_feature_len], init=w_init
        )

        # b is of shape (Mf)
        b = hk.get_parameter(&quot;b&quot;, shape=[message_feature_len], init=w_init)

        # wv is of shape (Mf,Nf)
        wv = hk.get_parameter(
            &quot;wv&quot;, shape=[message_feature_len, node_feature_len], init=w_init
        )

        # wu is of shape (Nf,Gf)
        wu = hk.get_parameter(
            &quot;wu&quot;, shape=[node_feature_len, graph_feature_len], init=w_init
        )

        # make nodes be N x N x Nf so we can just multiply directly (N = number of atoms)
        # ek is now shaped N x N x Mf
        ek = jax.nn.leaky_relu(
            b
            + jnp.repeat(nodes[jnp.newaxis, ...], nodes.shape[0], axis=0)
            @ we
            * edges[..., None]
        )

        # Uncomment lines below to update edges (also edit return line so new_edges is returned)
        # Update edges, use jnp.any to have new_edges be of shape N x N
        # new_edges = jnp.any(ek, axis=-1)

        # Normalize over edge features w/layer normalization
        # new_edges = hk.LayerNorm(axis=[0,1], create_scale=False, create_offset=False, eps=1e-05)(new_edges)

        # take sum over neighbors to get ebar shape = Nf x Mf
        ebar = jnp.sum(ek, axis=1)

        # dense layer for new nodes to get new_nodes shape = N x Nf
        new_nodes = jax.nn.leaky_relu(ebar @ wv) + nodes  # Use leaky ReLU

        # Normalize over node features w/layer normalization
        new_nodes = hk.LayerNorm(
            axis=[0, 1], create_scale=False, create_offset=False, eps=1e-05
        )(new_nodes)

        # sum over nodes to get shape features so global_node_features shape = Nf
        global_node_features = jnp.sum(new_nodes, axis=0)

        # dense layer for new features so new_features shape = Gf
        new_features = (
            jax.nn.leaky_relu(global_node_features @ wu) + features
        )  # Use leaky ReLU for activation

        # just return features for ease of use
        return new_nodes, edges, new_features


def model_fn(x):
    nodes, edges = x
    features = jnp.ones(graph_feat_length)
    x = nodes, edges, features

    # NOTE: If edited num_GNN_layers, need to edit code below (increase or decrease # times have x = GNNLayer(...))
    # 4 GNN layers
    x = GNNLayer(output_size=graph_feat_length)(x)
    x = GNNLayer(output_size=graph_feat_length)(x)
    x = GNNLayer(output_size=graph_feat_length)(x)
    x = GNNLayer(output_size=graph_feat_length)(x)

    # 2 dense layers
    logits = hk.Linear(numClasses)(x[-1])
    # logits = jax.nn.relu(logits) #ReLU activation between dense layer
    logits = hk.Linear(numClasses)(logits)

    return logits  # Model now returns logits


model = hk.without_apply_rng(hk.transform(model_fn))

# Initialize model
rng = jax.random.PRNGKey(0)
sampleData = data.take(1)
for dataVal in sampleData:  # Look into later how to get larger set
    (nodes_i, edges_i), yi = dataVal
nodes_i = nodes_i.numpy()
edges_i = edges_i.numpy()

yi = yi.numpy()
xi = (nodes_i, edges_i)

params = model.init(rng, xi)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Load optimal parameters for GNN model
print(&quot;Edit fileName to change parameters being loaded&quot;)
fileName = &quot;optParams_dry-waterfall-17.npy&quot;  # Currently optimal parameters, edit when get better model
paramsArr = jnp.load(fileName, allow_pickle=True)
opt_params = {
    &quot;gnn_layer&quot;: {
        &quot;b&quot;: paramsArr[0],
        &quot;we&quot;: paramsArr[1],
        &quot;wu&quot;: paramsArr[2],
        &quot;wv&quot;: paramsArr[3],
    },
    &quot;gnn_layer_1&quot;: {
        &quot;b&quot;: paramsArr[4],
        &quot;we&quot;: paramsArr[5],
        &quot;wu&quot;: paramsArr[6],
        &quot;wv&quot;: paramsArr[7],
    },
    &quot;gnn_layer_2&quot;: {
        &quot;b&quot;: paramsArr[8],
        &quot;we&quot;: paramsArr[9],
        &quot;wu&quot;: paramsArr[10],
        &quot;wv&quot;: paramsArr[11],
    },
    &quot;gnn_layer_3&quot;: {
        &quot;b&quot;: paramsArr[12],
        &quot;we&quot;: paramsArr[13],
        &quot;wu&quot;: paramsArr[14],
        &quot;wv&quot;: paramsArr[15],
    },
    &quot;linear&quot;: {&quot;b&quot;: paramsArr[16], &quot;w&quot;: paramsArr[17]},
    &quot;linear_1&quot;: {&quot;b&quot;: paramsArr[18], &quot;w&quot;: paramsArr[19]},
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="explanation-plotting-related-functions">
<h2>Explanation &amp; plotting related functions<a class="headerlink" href="#explanation-plotting-related-functions" title="Permalink to this heading">¶</a></h2>
<section id="modified-functions-used-when-selecting-counterfactuals-such-that-only-the-label-for-the-selected-scent-is-flipped">
<h3>Modified functions used when selecting counterfactuals such that only the label for the selected scent is flipped<a class="headerlink" href="#modified-functions-used-when-selecting-counterfactuals-such-that-only-the-label-for-the-selected-scent-is-flipped" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def _select_examples(cond, examples, nmols):
    result = []

    # similarity filtered by if cluster/counter
    def cluster_score(e, i):
        return (e.cluster == i) * cond(e) * e.similarity

    clusters = set([e.cluster for e in examples])
    for i in clusters:
        close_counter = max(examples, key=lambda e, i=i: cluster_score(e, i))
        # check if actually is (since call could have been zero)
        if cluster_score(close_counter, i):
            result.append(close_counter)

    # trim, in case we had too many cluster
    result = sorted(result, key=lambda v: v.similarity * cond(v), reverse=True)[:nmols]

    # fill in remaining
    ncount = sum([cond(e) for e in result])
    fill = max(0, nmols - ncount)
    result.extend(
        sorted(examples, key=lambda v: v.similarity * cond(v), reverse=True)[:fill]
    )

    return list(filter(cond, result))


def cf_explain(examples, nmols):
    &quot;&quot;&quot;From given :obj:`Examples&lt;Example&gt;`, find closest counterfactuals (see :doc:`index`)
    :param examples: Output from :func:`sample_space`
    :param nmols: Desired number of molecules
    &quot;&quot;&quot;

    def is_counter(e):
        return e.yhat != examples[0].yhat

    scent_classes = np.array([x for x in scentClasses])
    origin_labels = np.array(
        [my_model(examples[0].smiles, scent) for scent in scent_classes]
    )
    print(origin_labels)
    #     print([scentClasses[i] for i, x in enumerate(origin_labels) if x==1])
    print(scent_classes[origin_labels == 1])

    selection = _select_examples(is_counter, examples[1:], len(examples[1:]))
    selection = sorted(
        selection, key=lambda v: v.similarity * is_counter(v), reverse=True
    )

    result = []
    for e in selection:
        labels = np.array([my_model(e.smiles, scent) for scent in scent_classes])
        flips = origin_labels != labels
        print(f&quot;flipped labels: {scent_classes[flips]}&quot;)
        flip_count = np.sum(flips)
        if flip_count &lt; 2 and e.similarity &gt; 0.3:
            result.append(e)
        if len(result) == nmols:
            break

    for i, r in enumerate(result):
        r.label = f&quot;Counterfactual {i+1}&quot;

    return examples[:1] + result
</pre></div>
</div>
</div>
</div>
</section>
<section id="cosine-similarity-function-used-to-compute-similarity-for-descriptor-explanations-with-multiple-base-molecules">
<h3>Cosine similarity function used to compute similarity for descriptor explanations with multiple base molecules<a class="headerlink" href="#cosine-similarity-function-used-to-compute-similarity-for-descriptor-explanations-with-multiple-base-molecules" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># compute dot product with labels
def cosine_similarity_base(df, bases, llists):
    df[&quot;label_dot&quot;] = np.array(0.0)
    for j, row in df.iterrows():
        if j in bases:
            base = j
            df[&quot;label_dot&quot;][j] = 1
        else:
            # cosine similarity
            if np.all(llists[j] == 0):
                df[&quot;label_dot&quot;][j] = 0
                continue
            df[&quot;label_dot&quot;][j] = (
                llists[base]
                @ llists[j]
                / np.linalg.norm(llists[base])
                / np.linalg.norm(llists[j])
            )
    return df
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions-used-for-generating-plots-with-model-fit-creating-a-list-of-exmol-examples-from-a-csv-file">
<h3>Functions used for generating plots with model fit &amp; creating a list of exmol Examples from a csv file<a class="headerlink" href="#functions-used-for-generating-plots-with-model-fit-creating-a-list-of-exmol-examples-from-a-csv-file" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Code in this cell taken from Solubility-RNN.ipynb notebook from https://github.com/ur-whitelab/exmol/blob/main/paper2_LIME/Solubility-RNN.ipynb
def weighted_mean(x, w):
    return np.sum(x * w) / np.sum(w)


def weighted_cov(x, y, w):
    return np.sum(w * (x - weighted_mean(x, w)) * (y - weighted_mean(y, w))) / np.sum(w)


def weighted_correlation(x, y, w):
    return weighted_cov(x, y, w) / np.sqrt(
        weighted_cov(x, x, w) * weighted_cov(y, y, w)
    )


def plot_correlation(space, descriptor_type):
    beta = exmol.lime_explain(space, descriptor_type)
    fkw = {&quot;figsize&quot;: (6, 4)}
    font = {&quot;family&quot;: &quot;normal&quot;, &quot;weight&quot;: &quot;normal&quot;, &quot;size&quot;: 16}

    fig = plt.figure(figsize=(10, 5))
    matplotlib.rc(&quot;axes&quot;, titlesize=12)
    matplotlib.rc(&quot;font&quot;, size=16)
    ax_dict = fig.subplot_mosaic(&quot;AABBB&quot;)
    # Plot space by fit
    base_examples = [e for e in space if e.is_origin == True]
    svg = plot_space_by_fit_multiple_bases(
        space,
        base_examples,
        figure_kwargs=fkw,
        mol_size=(200, 200),
        offset=1,
        ax=ax_dict[&quot;B&quot;],
        beta=beta,
    )
    # Compute y_wls
    w = np.array([1 / (1 + (1 / (e.similarity + 0.000001) - 1) ** 5) for e in space])
    non_zero = w &gt; 10 ** (-6)
    w = w[non_zero]
    N = w.shape[0]

    ys = np.array([e.yhat for e in space])[non_zero].reshape(N).astype(float)
    x_mat = np.array([list(e.descriptors.descriptors) for e in space])[
        non_zero
    ].reshape(N, -1)
    y_wls = x_mat @ beta
    y_wls += np.mean(ys)

    lower = np.min(ys)
    higher = np.max(ys)

    # set transparency using w
    norm = plt.Normalize(min(w), max(w))
    cmap = plt.cm.Oranges(w)
    cmap[:, -1] = w

    corr = weighted_correlation(ys, y_wls, w)

    ax_dict[&quot;A&quot;].plot(
        np.linspace(lower, higher, 100),
        np.linspace(lower, higher, 100),
        &quot;--&quot;,
        linewidth=2,
    )
    sc = ax_dict[&quot;A&quot;].scatter(ys, y_wls, s=50, marker=&quot;.&quot;, c=cmap, cmap=cmap)
    ax_dict[&quot;A&quot;].text(max(ys) - 10, min(ys) + 1, f&quot;weighted \ncorrelation = {corr:.3f}&quot;)
    ax_dict[&quot;A&quot;].set_xlabel(r&quot;$\hat{y}$&quot;)
    ax_dict[&quot;A&quot;].set_ylabel(r&quot;$g$&quot;)
    ax_dict[&quot;A&quot;].set_title(&quot;Weighted Least Squares Fit&quot;)
    ax_dict[&quot;A&quot;].set_xlim(lower - 0.1, higher + 0.1)
    ax_dict[&quot;A&quot;].set_ylim(lower - 0.1, higher + 0.1)
    ax_dict[&quot;A&quot;].set_aspect(1.0 / ax_dict[&quot;A&quot;].get_data_ratio(), adjustable=&quot;box&quot;)
    sm = plt.cm.ScalarMappable(cmap=plt.cm.Oranges, norm=norm)
    cbar = plt.colorbar(sm, orientation=&quot;horizontal&quot;, pad=0.15, ax=ax_dict[&quot;A&quot;])
    cbar.set_label(&quot;Chemical similarity&quot;)
    plt.tight_layout()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Modified function for multiple bases based on plot_space_by_fit function in exmol plot_utils.py file
def plot_space_by_fit_multiple_bases(
    examples,
    exps,
    beta,
    mol_size=(200, 200),
    mol_fontsize=8,
    offset=0,
    ax=None,
    figure_kwargs=None,
    cartoon=False,
    rasterized=False,
):
    imgs = exmol.plot_utils._mol_images(exps, mol_size, mol_fontsize)
    if figure_kwargs is None:
        figure_kwargs = {&quot;figsize&quot;: (12, 8)}
    base_color = &quot;gray&quot;
    if ax is None:
        ax = plt.figure(**figure_kwargs).gca()

    yhat = np.array([e.yhat for e in examples]).astype(float)
    yhat -= np.mean(yhat)
    x_mat = np.array([list(e.descriptors.descriptors) for e in examples]).reshape(
        len(examples), -1
    )
    y = x_mat @ beta
    # use resids as colors
    colors = (yhat - y) ** 2
    normalizer = plt.Normalize(min(colors), max(colors))
    cmap = &quot;PuBu_r&quot;

    space_x = [e.position[0] for e in examples]
    space_y = [e.position[1] for e in examples]
    if cartoon:
        # plot shading, lines, front
        ax.scatter(space_x, space_y, 50, &quot;0.0&quot;, lw=2, rasterized=rasterized)
        ax.scatter(space_x, space_y, 50, &quot;1.0&quot;, lw=0, rasterized=rasterized)
        ax.scatter(
            space_x,
            space_y,
            50,
            c=normalizer(colors),
            cmap=cmap,
            lw=2,
            alpha=0.1,
            rasterized=rasterized,
        )
    else:
        im = ax.scatter(
            space_x,
            space_y,
            40,
            c=normalizer(colors),
            cmap=cmap,
            edgecolors=&quot;grey&quot;,
            linewidth=0.25,
        )
    ax.set_aspect(1.0 / ax.get_data_ratio(), adjustable=&quot;box&quot;)
    cbar = plt.colorbar(im, orientation=&quot;horizontal&quot;, aspect=35, pad=0.05)
    cbar.set_label(&quot;squared error&quot;)

    # now plot cfs/annotated points
    ax.scatter(
        [e.position[0] for e in exps],
        [e.position[1] for e in exps],
        c=normalizer([e.yhat for e in exps]),
        cmap=cmap,
        edgecolors=&quot;black&quot;,
    )

    x = np.array([e.position[0] for e in exps])
    y = np.array([e.position[1] for e in exps])

    titles = []
    colors = []
    for e in exps:
        if not e.is_origin:
            titles.append(f&quot;Similarity = {e.similarity:.2f}\nf(x)={e.yhat:.3f}&quot;)
            colors.append(cast(any, base_color))
        else:
            titles.append(f&quot;Base \nf(x)={e.yhat:.3f}&quot;)
            colors.append(cast(any, base_color))
    # exmol.plot_utils._image_scatter(x, y, imgs, titles, colors, ax, offset=offset)
    ax.axis(&quot;off&quot;)
    ax.set_aspect(&quot;auto&quot;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def createExampleListfromDataFrame(data):
    exampleList = []  # list[exmol.Example]()
    for i in range(len(data.index)):
        # Since reading position values from csv file, data.position is a string - need to convert to list of floats
        positionString = data.position.tolist()[i]
        positionString = positionString.replace(&quot;[&quot;, &quot;&quot;)
        positionString = positionString.replace(&quot;]&quot;, &quot;&quot;)
        positionList = positionString.split(&quot; &quot;)
        # remove empty string (&#39;&#39;) elements in positionList
        while &quot;&quot; in positionList:
            positionList.remove(&quot;&quot;)
        positions = [float(p) for p in positionList]
        # using weighted tanimoto with dot product
        exampleList.append(
            exmol.Example(
                data.smiles.tolist()[i],
                data.selfies.tolist()[i],
                data.similarity.tolist()[i],
                data.yhat.tolist()[i],
                data.index.tolist()[i],
                positions,
                data.is_origin.tolist()[i],
                data.cluster.tolist()[i],
                data.label.tolist()[i],
            )
        )
    return exampleList
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-modified-alphabet-to-use-when-creating-explanations">
<h3>Create modified alphabet to use when creating explanations<a class="headerlink" href="#create-modified-alphabet-to-use-when-creating-explanations" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create modified alphabet to use
alphabet = exmol.get_basic_alphabet()
to_remove = []
# remove [B],[#B],[=B]
to_remove.extend([&quot;[B]&quot;, &quot;[#B]&quot;, &quot;[=B]&quot;])

# remove [I],[F],[Cl], [Br]
to_remove.extend([&quot;[I]&quot;, &quot;[F]&quot;, &quot;[Cl]&quot;, &quot;[Br]&quot;])

alphabet -= set(to_remove)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Check that alphabet does not contain boron, iodine, fluorine, bromine nor chlorine
&quot;&quot;&quot;
print(alphabet)

boronInAlphabet = (&quot;[#B]&quot; in alphabet) and (&quot;[B]&quot; in alphabet) and (&quot;[=B]&quot; in alphabet)
iodineInAlphabet = (&quot;[I]&quot; in alphabet)
fluorineInAlphabet = (&quot;[F]&quot; in alphabet)
bromineInAlphabet = (&quot;[Br]&quot; in alphabet)
chlorineInAlphabet = (&quot;[Cl]&quot; in alphabet)

#Boron is in exmol basic alphabet
print(&quot;Check that using modified basic alphabet (i.e. no Boron, Iodine, Fluorine, Bromine, nor Chlorine)&quot;)
print(f&quot;Boron is in basic alphabet? {boronInAlphabet}&quot;)
print(f&quot;Iodine is in basic alphabet? {iodineInAlphabet}&quot;)
print(f&quot;Fluorine is in basic alphabet? {fluorineInAlphabet}&quot;)
print(f&quot;Bromine is in basic alphabet? {bromineInAlphabet}&quot;)
print(f&quot;Chlorine is in basic alphabet? {chlorineInAlphabet}&quot;)
&quot;&quot;&quot;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="generating-counterfactual-explanations-for-ethyl-benzoate-fruity">
<h2>Generating counterfactual explanations for ethyl benzoate (“fruity”)<a class="headerlink" href="#generating-counterfactual-explanations-for-ethyl-benzoate-fruity" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># For counterfactuals, need hard yhat values - read in thresholds from csv file
thresholds = pd.read_csv(
    &quot;ThresholdsForMaxF1_OdorlessClassRemoved_dry-waterfall-17_trainAndValid.csv&quot;
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Model function that takes in SMILES string and scent string as input (rather than molecular graph + parameter)
# Output is prediction on whether molecule has a certain scent (1) or not (0)
def my_model(smilesString, scentString):
    molecularGraph = gen_smiles2graph(smilesString)
    pos = scentClasses.index(scentString)
    thresholdIndex_scent = thresholds.index[thresholds.Scent == scentString].tolist()
    threshold = thresholds.Threshold[thresholdIndex_scent].tolist()[
        0
    ]  # Threshold is the one that maximizes the F1 score
    pred = jax.nn.sigmoid(model.apply(opt_params, molecularGraph))[pos]
    if pred &gt; threshold:
        pred = 1
    else:
        pred = 0
    return pred
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Molecules being examined/generating counterfactuals for:
fruity_ethylbenzoate = &quot;CCOC(=O)C1=CC=CC=C1&quot;  # Ethyl benzoate (https://pubchem.ncbi.nlm.nih.gov/compound/Ethyl-benzoate#section=InChI)

fatty_24decadienal = &quot;CCCCCC=CC=CC=O&quot;  # 2,4 Decadienal (https://pubchem.ncbi.nlm.nih.gov/compound/2_4-Decadienal#section=InChIKey)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Uncomment code below to generate ethyl benzoate counterfactuals around fruity
&quot;&quot;&quot;
samples_ethylbenzoate_fruity = exmol.sample_space(
    fruity_ethylbenzoate,
    lambda smi, sel: my_model(smi, &quot;fruity&quot;),
    batched=False,
    preset=&quot;medium&quot;,
    num_samples=20000,
    method_kwargs= {&#39;alphabet&#39;: alphabet}
)

cfs_ethylbenzoate_fruity = cf_explain(samples_ethylbenzoate_fruity, nmols=1)
exmol.plot_cf(cfs_ethylbenzoate_fruity[:2], figure_kwargs = {&#39;figsize&#39;: (10,8)}, mol_size=(300, 300), nrows = 1)
plt.show()
&quot;&quot;&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Read in ethyl benzoate cfs file &amp; create image
cfs_ethylbenzoate_fruity = createExampleListfromDataFrame(
    pd.read_csv(&quot;cfs_ethylbenzoate_fruity.csv&quot;)
)

# Uncomment lines below to save results to csv
# cfs_ethylbenzoate_fruity_data = pd.DataFrame(cfs_ethylbenzoate_fruity)
# cfs_ethylbenzoate_fruity_data.to_csv(&quot;cfs_ethylbenzoate_fruity.csv&quot;, index=False)
# samples_ethylbenzoate_fruity_data = pd.DataFrame(samples_ethylbenzoate_fruity)
# samples_ethylbenzoate_fruity_data.to_csv(&quot;samples_ethylbenzoate_fruity.csv&quot;, index=False)

exmol.plot_cf(
    cfs_ethylbenzoate_fruity[:2],
    figure_kwargs={&quot;figsize&quot;: (10, 8)},
    mol_size=(300, 300),
    nrows=1,
)
plt.show()
# plt.savefig(&quot;cfs_ethylbenzoate_fruity.png&quot;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-descriptor-explanations-natural-language-explanations-for-fatty">
<h2>Generate descriptor explanations &amp; natural language explanations for “fatty”<a class="headerlink" href="#generate-descriptor-explanations-natural-language-explanations-for-fatty" title="Permalink to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Function takes in a SMILES string for a molecule and returns the logit predictions for all scent classes
def my_model_allScents_logits(smilesString):
    molecularGraph = gen_smiles2graph(smilesString)
    logits_predictions = model.apply(opt_params, molecularGraph)
    return logits_predictions


# Function takes in a SMILES string for a molecule and returns the logit predictions for the specified scent
def my_model_logits(smilesString, scentString):
    molecularGraph = gen_smiles2graph(smilesString)
    pos = scentClasses.index(scentString)
    pred_logits = model.apply(opt_params, molecularGraph)[pos]
    return pred_logits
</pre></div>
</div>
</div>
</div>
<section id="create-sample-space">
<h3>Create sample space<a class="headerlink" href="#create-sample-space" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Uncomment code in cell below to generate sample space
&quot;&quot;&quot;
#For each positive example, generate sample space (using STONED) around that example (use that example as the base molecule)
space_total = []
scent = &#39;fatty&#39;
for i in range(numMolecules): #sample space created using positive examples
    molecule = scentdata.smiles[i]
    if(moleculeScentList[i].count(scent) == 1): 
        sampleSpace = exmol.sample_space(molecule, lambda smi, sel: my_model_logits(smi,scent), batched=False, preset=&#39;medium&#39;, num_samples=200, method_kwargs= {&#39;alphabet&#39;: alphabet})
        space_total.extend(sampleSpace)

space_total = pd.DataFrame(space_total)

#Get predictions for all scent classes for all molecules in the space
predictions_logits = []
mols = space_total[&#39;smiles&#39;]
for mol in mols:
    preds_logits = my_model_allScents_logits(mol)
    predictions_logits.append(preds_logits)

#Save the space along with scent class predictions to a csv file
scentClassesNamesWithLogits = []
for c in scentClasses:
    scentLogitString = f&#39;{c} + logits&#39;
    scentClassesNamesWithLogits.append(scentLogitString)

space_total[scentClassesNamesWithLogits] = predictions_logits
scentFileName = f&#39;space_{scent}.csv&#39;
space_total.to_csv(scentFileName)
space_total.head()
&quot;&quot;&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-in-sample-space-from-csv-file-create-list-of-exmol-examples-from-it">
<h3>Read in sample space from csv file &amp; create list of exmol Examples from it<a class="headerlink" href="#read-in-sample-space-from-csv-file-create-list-of-exmol-examples-from-it" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Download file for &quot;fatty&quot; space from figshare
filename, headers = urllib.request.urlretrieve(
    &quot;https://figshare.com/ndownloader/files/38472275&quot;
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>scent = &quot;fatty&quot;
# NOTE: below reading in a subset of the &quot;fatty&quot; sample space from figshare, code not working right now
df = pd.read_csv(
    filename,
    usecols=np.arange(1, 11),
)
labels = pd.read_csv(
    filename,
    usecols=np.append([1], np.arange(11, 123)),
)
llists = labels.to_numpy()[:, 1:]
bases = list(df[df[&quot;is_origin&quot;] == True].index)

df = cosine_similarity_base(df, bases, llists)
df[&quot;similarity&quot;] = df[&quot;similarity&quot;] * df[&quot;label_dot&quot;]

# Use smaller set of data (just to check code does not crash) - comment out line below when generating results
df = df.sample(frac=0.2, random_state=0).reset_index(drop=True)

samples = createExampleListfromDataFrame(df)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># delete pandas dataframe to save space
colNames = df.columns.values.tolist()
for c in colNames:
    del df[c]
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-descriptor-explanation-plots-for-fatty-plot-model-fit-for-each-explanatory-model">
<h3>Create descriptor explanation plots for “fatty” &amp; plot model fit for each explanatory model<a class="headerlink" href="#create-descriptor-explanation-plots-for-fatty-plot-model-fit-for-each-explanatory-model" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>beta_ECFP = exmol.lime_explain(
    samples, descriptor_type=&quot;ECFP&quot;
)  # create ECFP descriptor explanation

svg_ECFP = exmol.plot_descriptors(
    samples, figure_kwargs={&quot;figsize&quot;: (9, 5)}, return_svg=True
)
cairosvg.svg2png(svg_ECFP, write_to=f&quot;{scent}_ecfp.png&quot;, background_color=&quot;white&quot;)

base_examples = [e for e in samples if e.is_origin == True]

plot_correlation(samples, &quot;ECFP&quot;)  # plot ECFP model fit
# plt.savefig(f&#39;{scent}_ECFPfitAndCorrelation.png&#39;, bbox_inches=&quot;tight&quot;, transparent=False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>beta_MACCS = exmol.lime_explain(
    samples, descriptor_type=&quot;MACCS&quot;
)  # create MACCS descriptor explanation

svg_MACCS = exmol.plot_descriptors(
    samples, figure_kwargs={&quot;figsize&quot;: (9, 5)}, return_svg=True
)
cairosvg.svg2png(svg_MACCS, write_to=f&quot;{scent}_maccs.png&quot;, background_color=&quot;white&quot;)

base_examples = [e for e in samples if e.is_origin == True]

plot_correlation(samples, &quot;MACCS&quot;)  # plot MACCS model fit
# plt.savefig(f&#39;{scent}_MACCSfitAndCorrelation.png&#39;, bbox_inches=&quot;tight&quot;, transparent=False)
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-natural-language-explanations-for-fatty-scent">
<h3>Create natural language explanations for “fatty” scent<a class="headerlink" href="#create-natural-language-explanations-for-fatty-scent" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>exmol.lime_explain(samples, &quot;ecfp&quot;)
s1_ecfp = exmol.text_explain(samples, &quot;ecfp&quot;, presence_thresh=0.1)
exmol.lime_explain(samples, &quot;maccs&quot;)
s2_maccs = exmol.text_explain(samples, &quot;maccs&quot;, presence_thresh=0.1)

# print(f&#39;s1_ecfp: {s1_ecfp}\n&#39;)
# print(f&#39;s2_maccs: {s2_maccs}\n&#39;)

explanation_list = exmol.merge_text_explains(s1_ecfp, s2_maccs, filter=1.96)[:5]

# explanation_list = exmol.merge_text_explains(ecfp_standardized,maccs_standardized, filter=1.96)[:5]
prompt = exmol.text_prompt(explanation_list, f&quot;{scent} scent&quot;)
print(f&quot;Prompt: {prompt}&quot;)

# To create NLE from prompt, uncomment code below
# openAIKey = &#39;&#39; #Add in open AI key here to get NLE
# nle = exmol.text_prompt(explanation_list, f&#39;{scent} scent&#39;, open_ai_key=openAIKey))
# print(f&#39;NLE: {nle}&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="additional-code-to-examine-positive-examples-for-the-fatty-scent">
<h3>Additional code to examine positive examples for the “fatty” scent<a class="headerlink" href="#additional-code-to-examine-positive-examples-for-the-fatty-scent" title="Permalink to this heading">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>base_examples = [e for e in samples if e.is_origin]
rdkit.Chem.Draw.MolsToGridImage(
    [rdkit.Chem.MolFromSmiles(s.smiles) for s in base_examples], molsPerRow=6
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>maccs_string = &quot;Is there a C=O double bond?&quot;
count = 0
for base_mol in base_examples:
    pos_desc = base_mol.descriptors.descriptor_names.index(maccs_string)
    desc = base_mol.descriptors.descriptors[pos_desc]
    # print(desc, base_mol.descriptors.descriptor_names[pos_desc])
    if desc == 1:
        count += 1
print(
    f&#39;For the &quot;fatty&quot; base molecules, {count}/{len(base_examples)} match the descriptor: {maccs_string}&#39;
)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Geemi Wellawatte, Andrew D White.
      <span class="lastupdated">
        Last updated on True.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>